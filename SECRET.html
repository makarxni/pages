<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leafy Tic Tac Toe</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @keyframes leafFall {
            0% { transform: translateY(-100px) rotate(0deg); opacity: 0; }
            100% { transform: translateY(0) rotate(360deg); opacity: 1; }
        }
        
        .leaf-animation {
            animation: leafFall 1.5s ease-out forwards;
        }
        
        .cell:hover {
            transform: scale(1.05);
            transition: transform 0.2s ease;
        }
        
        .winning-line {
            position: absolute;
            background-color: rgba(34, 197, 94, 0.7);
            z-index: 10;
            transition: all 0.5s ease;
        }
    </style>
</head>
<body class="bg-green-50 min-h-screen font-sans">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <header class="text-center mb-8">
            <h1 class="text-4xl md:text-6xl font-bold text-green-800 mb-2">
                <i class="fas fa-leaf text-green-600 mr-2"></i>
                Leafy Tic Tac Toe
                <i class="fas fa-leaf text-green-600 ml-2"></i>
            </h1>
            <p class="text-green-700 text-lg md:text-xl">Play against our unbeatable AI in this nature-themed challenge!</p>
        </header>

        <!-- Game Controls -->
        <div class="flex flex-col md:flex-row justify-center items-center mb-8 gap-4">
            <div class="flex items-center">
                <span class="text-green-800 font-semibold mr-2">Difficulty:</span>
                <select id="difficulty" class="bg-green-100 border border-green-300 text-green-800 rounded-lg px-3 py-1 focus:ring-2 focus:ring-green-500">
                    <option value="easy">Easy</option>
                    <option value="medium">Medium</option>
                    <option value="hard" selected>Hard</option>
                    <option value="impossible">Impossible</option>
                </select>
            </div>
            
            <div class="flex items-center">
                <span class="text-green-800 font-semibold mr-2">You play as:</span>
                <div class="flex gap-2">
                    <button id="player-x" class="px-3 py-1 rounded-lg bg-green-600 text-white font-bold border-2 border-green-700">X</button>
                    <button id="player-o" class="px-3 py-1 rounded-lg bg-green-100 text-green-800 font-bold border-2 border-green-300">O</button>
                </div>
            </div>
            
            <button id="new-game" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white font-bold rounded-lg transition-colors">
                <i class="fas fa-redo mr-2"></i>New Game
            </button>
        </div>

        <!-- Game Board -->
        <div class="flex flex-col items-center">
            <div class="relative mb-4">
                <div id="board" class="grid grid-cols-3 gap-3 bg-green-200 p-4 rounded-xl shadow-lg">
                    <!-- Cells will be generated by JavaScript -->
                </div>
                <div id="winning-line" class="winning-line hidden"></div>
            </div>
            
            <div id="status" class="text-xl font-semibold text-green-800 mb-4">
                Your turn! Place your <span class="font-bold">X</span>
            </div>
            
            <div id="stats" class="flex gap-6 text-center">
                <div class="bg-green-100 px-4 py-2 rounded-lg">
                    <div class="text-green-600">Wins</div>
                    <div id="wins" class="text-2xl font-bold text-green-800">0</div>
                </div>
                <div class="bg-green-100 px-4 py-2 rounded-lg">
                    <div class="text-green-600">Losses</div>
                    <div id="losses" class="text-2xl font-bold text-green-800">0</div>
                </div>
                <div class="bg-green-100 px-4 py-2 rounded-lg">
                    <div class="text-green-600">Draws</div>
                    <div id="draws" class="text-2xl font-bold text-green-800">0</div>
                </div>
            </div>
        </div>

        <!-- Floating Leaves Decoration -->
        <div id="leaves-container" class="fixed top-0 left-0 w-full h-full pointer-events-none overflow-hidden z-0"></div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Game state
            let board = ['', '', '', '', '', '', '', '', ''];
            let currentPlayer = 'X';
            let gameActive = true;
            let playerSymbol = 'X';
            let aiSymbol = 'O';
            let difficulty = 'hard';
            
            // Stats
            let wins = 0;
            let losses = 0;
            let draws = 0;
            
            // DOM elements
            const boardElement = document.getElementById('board');
            const statusElement = document.getElementById('status');
            const winningLineElement = document.getElementById('winning-line');
            const leavesContainer = document.getElementById('leaves-container');
            
            // Initialize the board
            function initializeBoard() {
                boardElement.innerHTML = '';
                for (let i = 0; i < 9; i++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell w-20 h-20 md:w-24 md:h-24 bg-green-50 rounded-lg flex items-center justify-center text-4xl md:text-5xl font-bold cursor-pointer transition-all duration-200 shadow-md';
                    cell.dataset.index = i;
                    cell.addEventListener('click', () => handleCellClick(i));
                    boardElement.appendChild(cell);
                }
            }
            
            // Handle cell click
            function handleCellClick(index) {
                if (!gameActive || board[index] !== '' || currentPlayer !== playerSymbol) return;
                
                makeMove(index, playerSymbol);
                
                if (gameActive) {
                    setTimeout(() => aiMove(), 500);
                }
            }
            
            // Make a move
            function makeMove(index, symbol) {
                board[index] = symbol;
                const cell = boardElement.children[index];
                
                if (symbol === 'X') {
                    cell.innerHTML = '<i class="fas fa-times text-green-700 leaf-animation"></i>';
                } else {
                    cell.innerHTML = '<i class="far fa-circle text-green-600 leaf-animation"></i>';
                }
                
                const winningCombination = checkWin();
                if (winningCombination) {
                    handleWin(winningCombination);
                    return;
                }
                
                if (!board.includes('')) {
                    handleDraw();
                    return;
                }
                
                currentPlayer = currentPlayer === 'X' ? 'O' : 'X';
                updateStatus();
            }
            
            // AI move
            function aiMove() {
                if (!gameActive || currentPlayer !== aiSymbol) return;
                
                let move;
                
                switch (difficulty) {
                    case 'easy':
                        move = getRandomMove();
                        break;
                    case 'medium':
                        move = Math.random() > 0.5 ? getBestMove() : getRandomMove();
                        break;
                    case 'hard':
                        move = getBestMove();
                        break;
                    case 'impossible':
                        move = getBestMove(true);
                        break;
                    default:
                        move = getBestMove();
                }
                
                makeMove(move, aiSymbol);
            }
            
            // Get random move (for easy difficulty)
            function getRandomMove() {
                const availableMoves = board.map((cell, index) => cell === '' ? index : null).filter(val => val !== null);
                return availableMoves[Math.floor(Math.random() * availableMoves.length)];
            }
            
            // Minimax algorithm for AI
            function getBestMove(isImpossible = false) {
                // Simple immediate win/block for medium/hard
                if (!isImpossible) {
                    // Check for winning move
                    for (let i = 0; i < 9; i++) {
                        if (board[i] === '') {
                            board[i] = aiSymbol;
                            if (checkWin()) {
                                board[i] = '';
                                return i;
                            }
                            board[i] = '';
                        }
                    }
                    
                    // Check for blocking move
                    for (let i = 0; i < 9; i++) {
                        if (board[i] === '') {
                            board[i] = playerSymbol;
                            if (checkWin()) {
                                board[i] = '';
                                return i;
                            }
                            board[i] = '';
                        }
                    }
                }
                
                // Full minimax for impossible or when no immediate win/block
                let bestScore = -Infinity;
                let bestMove = null;
                
                for (let i = 0; i < 9; i++) {
                    if (board[i] === '') {
                        board[i] = aiSymbol;
                        let score = minimax(board, 0, false);
                        board[i] = '';
                        
                        if (score > bestScore) {
                            bestScore = score;
                            bestMove = i;
                        }
                    }
                }
                
                return bestMove;
            }
            
            function minimax(board, depth, isMaximizing) {
                const winner = checkWin();
                
                if (winner) {
                    return winner.winner === aiSymbol ? 10 - depth : depth - 10;
                }
                
                if (!board.includes('')) {
                    return 0;
                }
                
                if (isMaximizing) {
                    let bestScore = -Infinity;
                    for (let i = 0; i < 9; i++) {
                        if (board[i] === '') {
                            board[i] = aiSymbol;
                            let score = minimax(board, depth + 1, false);
                            board[i] = '';
                            bestScore = Math.max(score, bestScore);
                        }
                    }
                    return bestScore;
                } else {
                    let bestScore = Infinity;
                    for (let i = 0; i < 9; i++) {
                        if (board[i] === '') {
                            board[i] = playerSymbol;
                            let score = minimax(board, depth + 1, true);
                            board[i] = '';
                            bestScore = Math.min(score, bestScore);
                        }
                    }
                    return bestScore;
                }
            }
            
            // Check for win
            function checkWin() {
                const winPatterns = [
                    [0, 1, 2], [3, 4, 5], [6, 7, 8], // rows
                    [0, 3, 6], [1, 4, 7], [2, 5, 8], // columns
                    [0, 4, 8], [2, 4, 6]             // diagonals
                ];
                
                for (let pattern of winPatterns) {
                    const [a, b, c] = pattern;
                    if (board[a] && board[a] === board[b] && board[a] === board[c]) {
                        return {
                            winner: board[a],
                            pattern: pattern
                        };
                    }
                }
                
                return null;
            }
            
            // Handle win
            function handleWin(winningCombination) {
                gameActive = false;
                const winner = winningCombination.winner;
                
                // Update stats
                if (winner === playerSymbol) {
                    wins++;
                    document.getElementById('wins').textContent = wins;
                    statusElement.innerHTML = `You win! <i class="fas fa-trophy text-yellow-500"></i>`;
                    createConfetti();
                } else {
                    losses++;
                    document.getElementById('losses').textContent = losses;
                    statusElement.innerHTML = `AI wins! <i class="fas fa-robot text-gray-600"></i>`;
                }
                
                // Show winning line
                drawWinningLine(winningCombination.pattern);
            }
            
            // Handle draw
            function handleDraw() {
                gameActive = false;
                draws++;
                document.getElementById('draws').textContent = draws;
                statusElement.textContent = "It's a draw!";
            }
            
            // Draw winning line
            function drawWinningLine(pattern) {
                const [a, b, c] = pattern;
                const cellSize = window.innerWidth < 768 ? 80 : 96;
                const gap = 12;
                const boardRect = boardElement.getBoundingClientRect();
                
                const pos1 = boardElement.children[a].getBoundingClientRect();
                const pos3 = boardElement.children[c].getBoundingClientRect();
                
                const x1 = pos1.left + cellSize/2 - boardRect.left;
                const y1 = pos1.top + cellSize/2 - boardRect.top;
                const x2 = pos3.left + cellSize/2 - boardRect.left;
                const y2 = pos3.top + cellSize/2 - boardRect.top;
                
                const length = Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));
                const angle = Math.atan2(y2 - y1, x2 - x1) * 180 / Math.PI;
                
                winningLineElement.style.width = `${length}px`;
                winningLineElement.style.height = '8px';
                winningLineElement.style.left = `${x1}px`;
                winningLineElement.style.top = `${y1}px`;
                winningLineElement.style.transformOrigin = '0 0';
                winningLineElement.style.transform = `rotate(${angle}deg)`;
                
                winningLineElement.classList.remove('hidden');
            }
            
            // Update status message
            function updateStatus() {
                if (currentPlayer === playerSymbol) {
                    statusElement.innerHTML = `Your turn! Place your <span class="font-bold">${playerSymbol}</span>`;
                } else {
                    statusElement.innerHTML = `AI is thinking... <i class="fas fa-cog fa-spin text-green-700"></i>`;
                }
            }
            
            // Reset game
            function resetGame() {
                board = ['', '', '', '', '', '', '', '', ''];
                gameActive = true;
                currentPlayer = playerSymbol;
                winningLineElement.classList.add('hidden');
                initializeBoard();
                updateStatus();
                
                // AI starts first if player is O
                if (playerSymbol === 'O') {
                    setTimeout(() => aiMove(), 500);
                }
            }
            
            // Create confetti effect
            function createConfetti() {
                for (let i = 0; i < 30; i++) {
                    createLeaf();
                }
            }
            
            // Create floating leaves
            function createLeaf() {
                const leaf = document.createElement('div');
                const size = Math.random() * 20 + 10;
                const left = Math.random() * 100;
                const delay = Math.random() * 5;
                const duration = Math.random() * 3 + 3;
                const spin = Math.random() > 0.5 ? 'fa-leaf' : 'fa-seedling';
                const color = `hsl(${Math.random() * 60 + 80}, 70%, ${Math.random() * 30 + 50}%)`;
                
                leaf.innerHTML = `<i class="fas ${spin}" style="color: ${color};"></i>`;
                leaf.style.position = 'absolute';
                leaf.style.left = `${left}%`;
                leaf.style.top = '-30px';
                leaf.style.fontSize = `${size}px`;
                leaf.style.animation = `leafFall ${duration}s ease-in ${delay}s forwards`;
                leaf.style.zIndex = '0';
                
                leavesContainer.appendChild(leaf);
                
                // Remove leaf after animation
                setTimeout(() => {
                    leaf.remove();
                }, (duration + delay) * 1000);
            }
            
            // Event listeners for controls
            document.getElementById('new-game').addEventListener('click', resetGame);
            
            document.getElementById('player-x').addEventListener('click', () => {
                playerSymbol = 'X';
                aiSymbol = 'O';
                document.getElementById('player-x').classList.add('bg-green-600', 'text-white', 'border-green-700');
                document.getElementById('player-x').classList.remove('bg-green-100', 'text-green-800', 'border-green-300');
                document.getElementById('player-o').classList.add('bg-green-100', 'text-green-800', 'border-green-300');
                document.getElementById('player-o').classList.remove('bg-green-600', 'text-white', 'border-green-700');
                resetGame();
            });
            
            document.getElementById('player-o').addEventListener('click', () => {
                playerSymbol = 'O';
                aiSymbol = 'X';
                document.getElementById('player-o').classList.add('bg-green-600', 'text-white', 'border-green-700');
                document.getElementById('player-o').classList.remove('bg-green-100', 'text-green-800', 'border-green-300');
                document.getElementById('player-x').classList.add('bg-green-100', 'text-green-800', 'border-green-300');
                document.getElementById('player-x').classList.remove('bg-green-600', 'text-white', 'border-green-700');
                resetGame();
            });
            
            document.getElementById('difficulty').addEventListener('change', (e) => {
                difficulty = e.target.value;
                resetGame();
            });
            
            // Create some floating leaves on load
            for (let i = 0; i < 10; i++) {
                setTimeout(() => createLeaf(), i * 1000);
            }
            
            // Initialize the game
            initializeBoard();
        });
    </script>
</body>
</html>